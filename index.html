<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–î–æ–∫—É–º–µ–Ω—Ç—ã ‚Äî –£—á–µ–±–Ω—ã–π –ø–æ—Ä—Ç–∞–ª (–ü–ê–û –£—Ä–∞–ª—Å–∏–±–±–∞–Ω–∫)</title>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #e4edf9 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      padding: 20px 0;
      margin-bottom: 30px;
    }

    header h1 {
      color: #003f7f;
      font-size: 28px;
      font-weight: 700;
    }

    .login-screen, .main-app, #addForm {
      background: white;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      padding: 30px;
      max-width: 500px;
      margin: 50px auto;
    }

    .main-app, #addForm {
      display: none;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }

    .form-group input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }

    .form-group input[type="file"] {
      padding: 6px;
    }

    .btn {
      background: #0056b3;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
      font-weight: 600;
      transition: background 0.3s;
    }

    .btn:hover {
      background: #004494;
    }

    .btn-secondary {
      background: #6c757d;
    }

    .btn-secondary:hover {
      background: #5a6268;
    }

    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
    }

    .controls button {
      flex: 1;
    }

    .search-box {
      margin-bottom: 20px;
    }

    .search-box input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }

    .documents-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
    }

    .document-card {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      overflow: hidden;
      background: #fafafa;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .document-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .doc-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      cursor: pointer;
      background: #f0f0f0;
    }

    .doc-info {
      padding: 12px;
    }

    .doc-name {
      font-weight: 600;
      color: #003f7f;
      word-break: break-word;
    }

    .delete-btn {
      margin-top: 8px;
      background: #dc3545;
      padding: 6px 10px;
      font-size: 14px;
      width: auto;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal img {
      max-width: 90%;
      max-height: 90%;
      border: 2px solid white;
    }

    footer {
      text-align: center;
      margin-top: 40px;
      color: #777;
      font-size: 14px;
    }

    @media (max-width: 600px) {
      .login-screen, .main-app, #addForm {
        margin: 20px auto;
        padding: 20px;
      }
      .documents-grid {
        grid-template-columns: 1fr;
      }
      .controls {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>–ü–ê–û ¬´–£—Ä–∞–ª—Å–∏–±–±–∞–Ω–∫¬ª ‚Äî –ê—Ä—Ö–∏–≤ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</h1>
      <p style="color: #666; margin-top: 8px;">–£—á–µ–±–Ω—ã–π –ø–æ—Ä—Ç–∞–ª. –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ–±–ª–∞–∫–µ Firebase.</p>
    </header>

    <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
    <div class="login-screen" id="loginScreen">
      <h2 style="text-align: center; margin-bottom: 20px; color: #003f7f;">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
      <div class="form-group">
        <label for="password">–ü–∞—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞:</label>
        <input type="password" id="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å (1265)" autocomplete="off" />
      </div>
      <button class="btn" onclick="attemptLogin()">–í–æ–π—Ç–∏</button>
      <p style="margin-top: 15px; color: #888; font-size: 14px;">
        –≠—Ç–æ —É—á–µ–±–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞. –ù–∞—Å—Ç–æ—è—â–∏–π –±–∞–Ω–∫ –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–∞—Ä–æ–ª—å –Ω–∞ –≤—Ö–æ–¥ –≤ –∞—Ä—Ö–∏–≤.
      </p>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div class="main-app" id="mainApp">
      <div class="controls">
        <button class="btn" onclick="showAddForm()">–î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</button>
        <button class="btn btn-secondary" onclick="logout()">–í—ã–π—Ç–∏</button>
      </div>

      <div class="search-box">
        <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–∞..." oninput="filterDocuments()" />
      </div>

      <div class="documents-grid" id="documentsContainer">
        <!-- –î–æ–∫—É–º–µ–Ω—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
      </div>
    </div>

    <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <div id="addForm">
      <h2 style="text-align: center; margin-bottom: 20px; color: #003f7f;">–ù–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç</h2>
      <div class="form-group">
        <label for="docName">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞:</label>
        <input type="text" id="docName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–∏–∫–∞–∑ –æ–± —É–≤–æ–ª—å–Ω–µ–Ω–∏–∏" />
      </div>
      <div class="form-group">
        <label for="docImage">–§–æ—Ç–æ/—Å–∫–∞–Ω –¥–æ–∫—É–º–µ–Ω—Ç–∞:</label>
        <input type="file" id="docImage" accept="image/*" />
      </div>
      <button class="btn" onclick="uploadDocument()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button class="btn btn-secondary" style="margin-top: 10px;" onclick="hideAddForm()">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
  <div class="modal" id="imageModal" onclick="closeModal()">
    <img id="modalImage" src="" alt="–£–≤–µ–ª–∏—á–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ" />
  </div>

  <footer>
    –£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç | Firebase Storage + Realtime DB | –ù–µ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ–¥—É–∫—Ç–æ–º –ü–ê–û ¬´–£—Ä–∞–ª—Å–∏–±–±–∞–Ω–∫¬ª
  </footer>

  <script>
    // === üîë –í–ê–ñ–ù–û: –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –°–í–û–ô –ö–û–ù–§–ò–ì –ò–ó FIREBASE CONSOLE ===
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "renessans-bank-3df94.firebaseapp.com",
      databaseURL: "https://renessans-bank-3df94-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "renessans-bank-3df94",
      storageBucket: "renessans-bank-3df94.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const storage = firebase.storage();

    let documents = [];

    // === –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ ===
    function attemptLogin() {
      const pass = document.getElementById('password').value.trim();
      if (pass === '1265') {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('mainApp').style.display = 'block';
        loadDocuments();
      } else {
        alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
      }
    }

    function logout() {
      document.getElementById('mainApp').style.display = 'none';
      document.getElementById('password').value = '';
      document.getElementById('loginScreen').style.display = 'block';
    }

    // === –†–∞–±–æ—Ç–∞ —Å —Ñ–æ—Ä–º–æ–π ===
    function showAddForm() {
      document.getElementById('addForm').style.display = 'block';
    }

    function hideAddForm() {
      document.getElementById('addForm').style.display = 'none';
      document.getElementById('docName').value = '';
      document.getElementById('docImage').value = '';
    }

    // === –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ ===
    async function uploadDocument() {
      const name = document.getElementById('docName').value.trim();
      const fileInput = document.getElementById('docImage');
      if (!name) {
        alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞.');
        return;
      }
      if (!fileInput.files[0]) {
        alert('–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞.');
        return;
      }

      const file = fileInput.files[0];
      const reader = new FileReader();
      reader.onload = async function(e) {
        const base64 = e.target.result;

        const storageRef = storage.ref();
        const imgRef = storageRef.child('document_portal/' + Date.now() + '_' + file.name);
        try {
          await imgRef.putString(base64, 'data_url');
          const url = await imgRef.getDownloadURL();

          const newDocRef = database.ref('document_portal').push();
          await newDocRef.set({
            id: newDocRef.key,
            name: name,
            imageUrl: url,
            timestamp: firebase.database.ServerValue.TIMESTAMP
          });

          alert('–î–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
          hideAddForm();
          loadDocuments();
        } catch (err) {
          console.error(err);
          alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ: ' + (err.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
        }
      };
      reader.readAsDataURL(file);
    }

    // === –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ===
    async function loadDocuments() {
      const container = document.getElementById('documentsContainer');
      container.innerHTML = '<p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤...</p>';
      try {
        const snapshot = await database.ref('document_portal').once('value');
        documents = [];
        if (snapshot.exists()) {
          snapshot.forEach(child => {
            documents.push(child.val());
          });
        }
        renderDocuments(documents);
      } catch (err) {
        console.error(err);
        container.innerHTML = '<p style="color:red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase.</p>';
      }
    }

    // === –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ ===
    function renderDocuments(docs) {
      const container = document.getElementById('documentsContainer');
      if (docs.length === 0) {
        container.innerHTML = '<p>–ù–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.</p>';
        return;
      }
      container.innerHTML = docs.map(doc => `
        <div class="document-card">
          <img src="${escapeHtml(doc.imageUrl)}" class="doc-image" onclick="openImage('${escapeHtml(doc.imageUrl)}')" alt="${escapeHtml(doc.name)}" />
          <div class="doc-info">
            <div class="doc-name">${escapeHtml(doc.name)}</div>
            <button class="btn delete-btn" onclick="deleteDocument('${escapeHtml(doc.id)}')">–£–¥–∞–ª–∏—Ç—å</button>
          </div>
        </div>
      `).join('');
    }

    function filterDocuments() {
      const term = document.getElementById('searchInput').value.toLowerCase().trim();
      const filtered = documents.filter(doc => 
        doc.name.toLowerCase().includes(term)
      );
      renderDocuments(filtered);
    }

    // === –£–¥–∞–ª–µ–Ω–∏–µ ===
    function deleteDocument(id) {
      if (!confirm('–£–¥–∞–ª–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;
      database.ref('document_portal/' + id).remove()
        .then(() => {
          alert('–î–æ–∫—É–º–µ–Ω—Ç —É–¥–∞–ª—ë–Ω.');
          loadDocuments();
        })
        .catch(err => {
          alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + err.message);
        });
    }

    // === –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ===
    function openImage(src) {
      document.getElementById('modalImage').src = src;
      document.getElementById('imageModal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('imageModal').style.display = 'none';
    }

    // === –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ===
    function escapeHtml(text) {
      if (typeof text !== 'string') return '';
      return text
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Esc
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeModal();
    });
  </script>
</body>
</html>
